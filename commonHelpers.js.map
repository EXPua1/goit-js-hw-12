{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst apiKey = '44853221-20be0a035158c611166c29677';\nconst apiUrl = 'https://pixabay.com/api/';\n\nexport default async function searchImage(query) {\n  const encodedQuery = encodeURIComponent(query);\n  const url = `${apiUrl}?key=${apiKey}&q=${encodedQuery}&image_type=photo&orientation=horizontal&safesearch=true`;\n\n  return axios.get(url);\n}\n","import SimpleLightbox from 'simplelightbox';\n// Дополнительный импорт стилей\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\n// Инициализация SimpleLightbox\nlet lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n  close: true,\n  nav: true,\n});\n\nexport default function createGallery(imagesData) {\n  const gallery = document.querySelector('.gallery');\n  gallery.innerHTML = '';\n\n  // Создание HTML строк для всех изображений\n  const galleryHTML = imagesData\n    .map(\n      image => `\n    <div class=\"card\">\n      <a href=\"${image.largeImageURL}\" title=\"${image.tags}\">\n        <img src=\"${image.webformatURL}\" alt=\"${image.tags}\">\n      </a>\n      <div class=\"card-info\">\n        <p>Likes ${image.likes}</p>\n        <p>Views ${image.views}</p>\n        <p>Comments ${image.comments}</p>\n        <p>Downloads ${image.downloads}</p>\n      </div>\n    </div>\n  `\n    )\n    .join('');\n\n  gallery.insertAdjacentHTML('beforeend', galleryHTML);\n\n  // Обновление lightbox после добавления новых элементов\n  lightbox.refresh();\n}\n","import searchImage from './js/pixabay-api';\nimport createGallery from './js/render-functions';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst searchBtn = document.querySelector('.search button');\nconst input = document.querySelector('.search input');\nconst gallery = document.querySelector('.gallery');\n\nlet isSearching = false; // Флаг для отслеживания состояния выполнения запроса\nlet page = 1;\nconst perPage = 15;\n\nsearchBtn.addEventListener('click', () => {\n  if (isSearching) {\n    return; // Если уже выполняется запрос, выходим из функции\n  }\n\n  if (input.value === '') {\n    iziToast.info({\n      title: 'Внимание',\n      message: 'Введите текст для поиска изображений',\n      position: 'topRight',\n    });\n    return;\n  }\n\n  isSearching = true; // Устанавливаем флаг выполнения запроса в true\n  page = 1; // Сбрасываем страницу на 1 для нового поиска\n  gallery.innerHTML = ''; // Очищаем галерею для нового поиска\n  searchImages();\n});\n\nasync function searchImages() {\n  try {\n    addLoader();\n    const response = await searchImage(input.value, page, perPage);\n    if (response.data.hits.length === 0) {\n      iziToast.alert({\n        title: 'Error',\n        message: 'No images found. Please try again.',\n        position: 'topRight',\n      });\n    } else {\n      createGallery(response.data.hits);\n      input.value = ''; // Очистить поле ввода после успешного поиска\n      addFetchButton();\n    }\n  } catch (error) {\n    console.error('Ошибка при выполнении поискового запроса:', error);\n    iziToast.error({\n      title: 'Error',\n      message: 'An error occurred during the search. Please try again later.',\n      position: 'topRight',\n    });\n  } finally {\n    removeLoader(); // Убираем загрузчик после завершения запроса или при ошибке\n    isSearching = false; // Сбрасываем флаг выполнения запроса\n  }\n}\n\nfunction addFetchButton() {\n  removeFetchButton(); // Удаляем существующую кнопку, если есть\n  const fetchButton = document.createElement('button');\n  fetchButton.textContent = 'Fetch more posts';\n  fetchButton.addEventListener('click', fetchPosts);\n  gallery.appendChild(fetchButton);\n}\n\nfunction removeFetchButton() {\n  const fetchButton = gallery.querySelector('button');\n  if (fetchButton) {\n    fetchButton.remove();\n  }\n}\n\nasync function fetchPosts() {\n  if (isSearching) {\n    return; // Если уже выполняется запрос, выходим из функции\n  }\n\n  isSearching = true; // Устанавливаем флаг выполнения запроса в true\n  page += 1; // Увеличиваем номер страницы для следующего запроса\n\n  try {\n    addLoader();\n    const response = await searchImage(input.value, page, perPage);\n    if (response.data.hits.length === 0) {\n      iziToast.alert({\n        title: 'Error',\n        message: 'No more images found.',\n        position: 'topRight',\n      });\n    } else {\n      createGallery(response.data.hits);\n      if (response.data.hits.length === perPage) {\n        addFetchButton();\n      }\n    }\n  } catch (error) {\n    console.error('Ошибка при выполнении поискового запроса:', error);\n    iziToast.error({\n      title: 'Error',\n      message: 'An error occurred during the search. Please try again later.',\n      position: 'topRight',\n    });\n  } finally {\n    removeLoader(); // Убираем загрузчик после завершения запроса или при ошибке\n    isSearching = false; // Сбрасываем флаг выполнения запроса\n  }\n}\n\nfunction addLoader() {\n  gallery.insertAdjacentHTML(\n    'afterbegin',\n    '<div class=\"loader\">Loading...</div>'\n  );\n}\n\nfunction removeLoader() {\n  const loader = gallery.querySelector('.loader');\n  if (loader) {\n    loader.parentNode.removeChild(loader);\n  }\n}\n"],"names":["apiKey","apiUrl","searchImage","query","encodedQuery","url","axios","lightbox","SimpleLightbox","createGallery","imagesData","gallery","galleryHTML","image","searchBtn","input","isSearching","page","perPage","iziToast","searchImages","addLoader","response","addFetchButton","error","removeLoader","removeFetchButton","fetchButton","fetchPosts","loader"],"mappings":"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"}